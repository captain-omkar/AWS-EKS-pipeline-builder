version: '3.8'

services:
  backend:
    build: 
      context: ./backend
      dockerfile: Dockerfile
    container_name: aws-pipeline-builder-backend
    ports:
      - "5000:5000"
    environment:
      - CONFIG_PATH=/app/config/appsettings.json
    volumes:
      # Configuration files
      - ./backend/appsettings.json:/app/config/appsettings.json
      - ./backend/pipeline_settings.json:/app/pipeline_settings.json
      - ./backend/pipeline_metadata.json:/app/pipeline_metadata.json
      - ./backend/env_suggestions.json:/app/env_suggestions.json
      # AWS credentials (optional - remove if using instance profile)
      - ~/.aws:/root/.aws:ro
    networks:
      - pipeline-network
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: aws-pipeline-builder-frontend
    ports:
      - "3000:80"
    volumes:
      # Runtime configuration
      - ./frontend/public/config.docker.js:/usr/share/nginx/html/config.js:ro
    depends_on:
      - backend
    networks:
      - pipeline-network
    restart: unless-stopped

networks:
  pipeline-network:
    driver: bridge